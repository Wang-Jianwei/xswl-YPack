# 完整示例 YAML（包含尽可能详尽的字段注释）
# 该文件可作为语法参考示例，覆盖了项目支持的大多数字段

# 备注：
# - 原始 YAML 会保存在内部 _raw_dict（PackageConfig._raw_dict）以便变量解析和回溯。
# - 某些字段（如 PackageEntry.sources）支持多种写法：字符串、字典或列表；post_install 支持字符串或列表。
# - 变量说明：
#   - 配置引用（${...}）：用于引用 YAML 配置中的路径，例如 `${app.name}`、`${app.version}` 或 `${variables.DATA_DIR}`。这些在解析阶段由 `VariableResolver` 展开为具体值。
#   - 内置运行时变量（$VAR）：例如 `$INSTDIR`, `$PROGRAMFILES64`, `$APPDATA`，这些由 `VariablesRegistry` 定义并会在转换为目标安装器时映射到相应格式（NSIS 的 `$INSTDIR` 等），定义见 `ypack/variables.py`。
#   - 转换器/工具级宏（仅在生成的安装脚本中可用，非跨工具）：例如 NSIS 脚本里会看到的 `${APP_NAME}`, `${APP_VERSION}`, `${REG_KEY}` 等，这些由转换器（如 `convert_nsis.py`）在生成脚本时通过 `!define` 添加到目标脚本；它们不是 YAML 配置路径，不会被 `VariableResolver` 在 YAML 阶段解析。**为保持跨工具兼容性，应避免在 YAML 中直接依赖这类工具特定宏**。
#   - 自定义变量：例如 `variables.SIGN_PASS`（用于签名密码），可以在 YAML 的 `variables` 部分定义，或通过构建环境/CI 注入。敏感信息不要硬编码在仓库中。
# - 更多信息请参见 `docs/VARIABLES.md`、`ypack/variables.py` 和 `ypack/converters/convert_nsis.py` 中的实现。

# 应用信息
app:
  name: "MyApp"                                   # 应用名称（必需）
  version: "1.2.3"                                # 版本号（字符串）
  publisher: "Example Co."                        # 发布者/公司
  branding: "Example Co. - Quality Software"      # 品牌文本（安装程序中显示的品牌信息）
  description:                                    # 应用描述（用于安装界面等；支持多语言）
      en: "I'm an Example application"            # 英文描述
      zh: "我是一个示例应用程序"                    # 中文描述
  install_icon: "resources/icons/app.ico"         # 安装程序/快捷方式使用的图标路径（相对或绝对）
  uninstall_icon: "resources/icons/uninstall.ico" # 卸载程序使用的图标路径；若未提供，则默认使用 install_icon
  license:                                        # 许可文件路径（支持多语言）    
    en: "resources/license_en.txt"                # 英文许可文件（可为相对或绝对路径）
    zh: "resources/license_zh.txt"                # 简体中文许可文件（可为相对或绝对路径）

# 安装配置
install:
  install_dir: "$PROGRAMFILES64\\${app.name}"     # 安装目标目录（支持内置变量（$VAR）和配置引用（${app.name}））

  # 注意：desktop_shortcut、start_menu_shortcut、registry_entries、env_vars、file_associations
  # 这些字段也可以写在 packages 中的各个组件下，这样只有该组件被选中安装时，对应操作才会执行。
  # 写在 install 段的是全局配置，始终会执行。推荐将与特定组件相关的操作写在 packages 中。

  desktop_shortcut:                               # 桌面快捷方式配置（全局，始终执行；也可写在 packages 下按组件执行）
    name: "${app.name}"                           # 桌面快捷方式名称（可选，默认使用应用名）
    target: "$INSTDIR\\bin\\MyApp.exe"            # 桌面快捷方式目标（可选）

  start_menu_shortcut:                            # 开始菜单快捷方式配置（全局，始终执行；也可写在 packages 下按组件执行）
    name: "${app.name}"                           # 开始菜单快捷方式名称（可选，默认使用应用名）
    target: "$INSTDIR\\bin\\MyApp.exe"            # 开始菜单快捷方式目标（可选）

  registry_key: "Software\\${app.publisher}\\${app.name}" # 注册表键路径（用于存储安装信息等）
  registry_view: "auto"                                   # 注册表视图：auto | 32 | 64（默认 auto，根据系统自动选择）

  registry_entries:                                   # 注册表写入项（全局；也可写在 packages 下按组件执行）
    - hive: "HKLM"                                    # 注册表根：HKLM（系统范围）或 HKCU（用户范围）
      key: "Software\\${app.publisher}\\${app.name}"  # 注册表键路径
      name: "InstallPath"                             # 值名
      value: "$INSTDIR"                               # 值数据（支持变量）
      type: "string"                                  # 类型："string" | "expand" | "dword"
      view: "auto"                                    # 视图："auto" | "32" | "64"

  env_vars:                                        # 环境变量配置（全局；也可写在 packages 下按组件执行）
    - name: "MYAPP_HOME"                           # 变量名
      value: "$INSTDIR"                            # 值（可包含变量）
      scope: "system"                              # 'system' 写入 HKLM，'user' 写入 HKCU
      remove_on_uninstall: true                    # 卸载时是否移除
      append: false                                # 是否以追加方式处理（例如 PATH）

  file_associations:                                    # 文件关联配置（全局；也可写在 packages 下按组件执行）
    - extension: ".my"                                  # 扩展名（含点）
      prog_id: "${app.publisher}.${app.name}"           # ProgID
      description: "MyApp file"                         # 描述
      application: "$INSTDIR\\bin\\MyApp.exe \"%1\""    # 打开命令（通常包含 "%1"）
      default_icon: "$INSTDIR\\icons\\myfile.ico"       # 默认图标路径
      verbs:                                            # 动词映射（verb -> 命令）
        open: "$INSTDIR\\bin\\MyApp.exe \"%1\""         # open 动词
        edit: "$INSTDIR\\bin\\MyApp.exe --edit \"%1\""  # edit 动词
      register_for_all_users: true                      # 是否为所有用户注册

  system_requirements:                             # 安装前的系统检查
    min_windows_version: "10.0"                    # 最低 Windows 版本（例如 "10.0"）
    min_free_space_mb: 500                         # 所需最小磁盘空间（MB）
    min_ram_mb: 2048                               # 所需最小内存（MB）
    require_admin: true                            # 是否需要管理员权限

  launch_on_finish: "$INSTDIR\\bin\\MyApp.exe"     # 完成页复选框选中后运行的路径（可空）
  launch_on_finish_label:                            # 复选框显示文字（可选，支持多语言）
    en: "Run ${app.name}"
    zh: "启动 ${app.name}"
  launch_in_background: false                      # 启动时是否在后台运行（false 可等待执行完成）

  installer_name: "${app.name}-${app.version}-Setup.exe"  # 可选：自定义安装包文件名。可被 CLI --installer-name 覆盖

  # Behavior when an existing installation is detected at the target location.
  # Supports two formats:
  #
  # Simple (string shorthand):
  #   existing_install: "prompt_uninstall"
  #
  # Full (object — all fields optional, defaults shown):
  existing_install:               # 已存在安装时的处理方式
    mode: "prompt_uninstall"      # prompt_uninstall | auto_uninstall | overwrite | abort | none
    version_check: false          # Skip detection if the installed version matches this version
    allow_multiple: false         # Only detect conflict when installing to the same directory
    uninstaller_args: "/S"        # CLI args passed to the old uninstaller
    show_version_info: true       # Show installed version in prompt/abort dialogs
    uninstall_wait_ms: 5000       # Max time (ms) to wait for the old uninstaller to finish; set to -1 to wait indefinitely (careful!)

files:
  - "bin/MyApp.exe"                                     # 简写：单个 source 字符串，默认 destination=$INSTDIR
  - source: "lib/"                                      # 详细项：支持 recursive 和其他字段
    destination: "$INSTDIR\\lib"                        # 指定目标路径

  - source: "data/config.yaml"                          # 本地文件示例
    destination: "$INSTDIR\\config"                     # 目标路径  

  - source: "https://example.com/artifacts/plugin.zip"  # 远程文件示例：source 直接填 URL（http/https），转换器自动识别为下载
    destination: "$INSTDIR\\plugins"                    # 下载后保存到指定目标目录
    checksum_type: "sha256"                             # 校验类型：sha256、sha1、md5 等
    checksum_value: "abc123..."                         # 校验值（用于验证下载完整性）
    decompress: true                                    # 下载后是否自动解压（适用于压缩包）

# 包/组件配置
packages:                                       # 包/组件配置（支持嵌套 children）
  Core:                                         # Package 名称（作为组件名）
    description: "Core Functionality"           # 组件描述
    optional: false                             # 是否为可选组件
    default: true                               # 是否默认勾选安装
    sources:                                    # 安装文件源（支持多种写法） 
      - source: "bin/*"                         # 通配符复制整个目录
        destination: "$INSTDIR"                 # 目标路径
      - source:                                 # 多源写法（列表）
          - "libs/libA.dll"                     # 单个文件  
          - "libs/libB/**/*"                    # 递归复制子目录  
        destination: "$INSTDIR\\libs"           # 目标路径

    # Per-package install actions（仅在该组件被选中安装时执行）
    desktop_shortcut:                           # 桌面快捷方式（仅 Core 安装时创建）
      name: "${app.name}"
      target: "$INSTDIR\\bin\\MyApp.exe"
    start_menu_shortcut:                        # 开始菜单快捷方式（仅 Core 安装时创建）
      name: "${app.name}"
      target: "$INSTDIR\\bin\\MyApp.exe"
    registry_entries:                           # 注册表项（仅 Core 安装时写入）
      - hive: "HKLM"
        key: "Software\\${app.publisher}\\${app.name}"
        name: "InstallPath"
        value: "$INSTDIR"
        type: "string"
    file_associations:                          # 文件关联（仅 Core 安装时注册）
      - extension: ".my"
        prog_id: "${app.publisher}.${app.name}"
        description: "MyApp file"
        application: "$INSTDIR\\bin\\MyApp.exe \"%1\""
        default_icon: "$INSTDIR\\icons\\myfile.ico"
        verbs:
          open: "$INSTDIR\\bin\\MyApp.exe \"%1\""
          edit: "$INSTDIR\\bin\\MyApp.exe --edit \"%1\""
        register_for_all_users: true

    children:                                   # 子组件（SectionGroup）
      Tools:                                    # 子组件名（此示例为 Tools 组件）   
        sources:                                # 安装文件源
          - source: "tools/*"
            destination: "$INSTDIR\\tools"
        optional: true
        default: false                          # 默认不勾选
        description: "Optional Tools"
        env_vars:                               # 环境变量（仅 Tools 安装时设置）
          - name: "MYAPP_TOOLS"
            value: "$INSTDIR\\tools"
            scope: "system"
            remove_on_uninstall: true
  Extras:                                       # 另一个组件示例
    description: "Extra Plugins and Add-ons"    # 组件描述
    optional: true                              # 是否为可选组件
    default: false                              # 默认不勾选
    source: "extras/"                           # 安装文件源
    destination: "$INSTDIR\\extras"             # 目标路径
    post_install:                               # 安装后要执行的命令（字符串或列表）
      - "$INSTDIR\\tools\\configure.bat"        
      - "echo \"Extras installed\" >> \"$INSTDIR\\install.log\""

# 代码签名配置
signing:
  enabled: true                                   # 是否启用代码签名
  certificate: "certs/MyCodeSign.pfx"             # 签名证书（PFX）路径
  password: "${variables.SIGN_PASS}"              # 证书密码（示例：使用配置中的自定义变量 `variables.SIGN_PASS`；敏感信息建议通过环境或 CI 注入，不要直接写入 YAML）
  timestamp_url: "http://timestamp.digicert.com"  # 时间戳服务器
  verify_signature: true                          # 是否在构建后校验签名
  checksum_type: "sha256"                         # 可选：用于验证签名/证书的校验类型
  checksum_value: "..."                           # 可选：校验值

# 自动更新配置
update:
  enabled: true                                           # 是否启用自动更新支持
  update_url: "https://updates.example.com/metadata.json" # 检查更新的元数据 URL（返回 JSON，包含最新版本信息和下载链接）
  download_url: "https://updates.example.com/downloads/"  # 更新包下载基础 URL（安装程序将根据元数据中的版本信息构建完整下载链接）
  backup_on_upgrade: true                                 # 升级时是否备份旧文件（以便回滚）
  repair_enabled: true                                    # 是否启用修复模式（若支持）（安装程序提供修复选项，重新安装当前版本以修复损坏的安装）
  check_on_startup: true                                  # 程序启动时是否检查更新（如果启用更新功能，安装程序会在应用启动时检查更新）
  registry_hive: "HKCU"                                   # 存储更新元数据所使用的注册表根
  registry_key: "Software\\${app.product}\\${app.name}"   # 更新元数据的注册表键（跨工具通用写法；使用配置引用 ${app.product} 和 ${app.name}；也可显式覆盖为具体字符串）

# 日志配置
logging:
  enabled: true                                    # 是否记录安装过程的日志
  path: "$INSTDIR\\install.log"                    # 日志路径（可为绝对或相对）
  level: "DEBUG"                                   # 日志级别：DEBUG, INFO, WARNING, ERROR

# 语言配置
# 常见 ypack 语言标识（本仓库保留的核心集）：
# English, SimplifiedChinese, TraditionalChinese, French, German, Spanish, Italian, Dutch,
# Portuguese, BrazilianPortuguese, Japanese, Korean, Russian, Polish, Czech, Hungarian,
# Turkish, Swedish, Norwegian, Danish, Ukrainian, Arabic, Thai, Vietnamese
# 也支持别名（大小写不敏感）：
#   chinese → SimplifiedChinese,
#   zh → SimplifiedChinese
#   en → English
#   ja → Japanese
#   ko → Korean
#   fr → French
#   de → German
#   es → Spanish
#   it → Italian
#   pt → Portuguese
#   brpt → BrazilianPortuguese
#   ru → Russian
# 更多语言和别名见 ypack/languages.py 中的定义。
languages:                                         # 支持的语言列表（ypack 跨工具语言标识；由转换器映射到具体工具，建议使用规范名）
  - English
  - SimplifiedChinese
  - French
  - ko

variables:              # 自定义变量（可在此处定义供 YAML 解析引用，注意不能和内置变量冲突）
  SIGN_PASS: "******"   # 签名证书密码的占位示例；建议在 CI/环境中注入此值，不要直接写入仓库

custom_includes:  # 针对不同工具的自定义 include 列表（如 nsis/wix）
  nsis:
    - "custom/includes/my_funcs.nsh"
    - "custom/includes/extra.nsh"
  wix:
    - "custom/wix/extensions/ext.wxs"
